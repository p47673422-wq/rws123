model Friend_x {
  id            String   @id @default(uuid())
  userId        String
  name          String
  mobile        String
  address       String
  gender        String
  maritalStatus String
  createdAt     DateTime @default(now())
  user          User_x   @relation(fields: [userId], references: [id])
}
model OrderDeliveryStatus {
  id        String   @id @default(uuid())
  orderId   String
  delivered Boolean
  deliveredAt DateTime?
  updatedAt DateTime @updatedAt
}

model User_x {
  id        String   @id @default(uuid())
  name      String
  mobile    String   @unique
  gender    String
  address   String
  createdAt DateTime @default(now())
  friends   Friend_x[]
  quizAnswers QuizAnswer_x[]
  commitments Commitment_x[]
  japaProgress JapaProgress_x[]
  gifts      Gift_x[]
  badges     Badge_x[]
}

model QuizAnswer_x {
  id          String   @id @default(uuid())
  userId      String
  level       Int
  questionKey String
  answer      String
  createdAt   DateTime @default(now())
  user        User_x   @relation(fields: [userId], references: [id])
  @@unique([userId, level, questionKey])
}

model Commitment_x {
  id                String   @id @default(uuid())
  userId            String
  roundsPerDay      Int
  friendsToInspire  Int
  joinJapa          Boolean
  createdAt         DateTime @default(now())
  user              User_x   @relation(fields: [userId], references: [id])
}

model JapaProgress_x {
  id        String   @id @default(uuid())
  userId    String
  day       Int
  rounds    Int
  count     Int      @default(0) // Number of chants not yet a full round
  createdAt DateTime @default(now())
  user      User_x   @relation(fields: [userId], references: [id])
  @@unique([userId, day])
}

model CounsellingRequest {
  id             String   @id @default(uuid())
  name           String
  mobile         String
  maritalStatus  String
  gender         String
  preferredDate  DateTime
  preferredTime  String
  createdAt      DateTime @default(now())
}

enum GiftType_x {
  QUIZ
  JAPA
}

model Gift_x {
  id        String   @id @default(uuid())
  userId    String
  level     Int
  type      GiftType_x
  name      String
  unlocked  Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User_x   @relation(fields: [userId], references: [id])
  @@unique([userId, level, type])
}

model Badge_x {
  id          String   @id @default(uuid())
  userId      String
  name        String
  description String
  unlocked    Boolean  @default(false)
  createdAt   DateTime @default(now())
  user        User_x   @relation(fields: [userId], references: [id])
}

enum CoType {
  PREACHER
  LEADER
  COUNCILER
}
enum PlaceType {
  SCHOOL
  COOLLEGE
  COMPANY
  PUBLIC_PLACE
  SHRESHTHA
  OTHER
}

model cordinatorUser {
  id                 String           @id @default(uuid())
  name               String
  email               String          @unique
  type               CoType
  password           String
  tempPasswordUsed   Boolean          @default(false)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  bookings           Booking[]
  rewardProgress     RewardProgress?
}

model Booking {
  id           String      @id @default(uuid())
  cordinatorId String
  placeType    PlaceType
  placeName    String
  date         DateTime
  time         String
  strength     Int
  duration     Int
  resources    String[]    // Array of resource names
  comment      String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  cordinator   cordinatorUser @relation(fields: [cordinatorId], references: [id])
}

model RewardProgress {
  id             String         @id @default(uuid())
  cordinatorId   String         @unique
  points         Int            @default(0)
  level          Int            @default(1)
  lastRewardedAt DateTime?
  totalStrength  Int      @default(0)
  totalBookings  Int      @default(0)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  user           cordinatorUser @relation(fields: [cordinatorId], references: [id])
}
model BhagavadGitaRegistration {
  id        String   @id @default(uuid())
  name      String
  mobile    String
  gender    String
  address   String
  maritalStatus String?
  language  String
  isOffline Boolean @default(false)
  createdAt DateTime @default(now())
  @@unique([mobile, language])
}
model Order {
  id        String      @id @default(uuid())
  user      User        @relation(fields: [userId], references: [id])
  userId    String
  total     Int
  createdAt DateTime    @default(now())
  items     OrderItem[]
}

model OrderItem {
  id        String   @id @default(uuid())
  order     Order    @relation(fields: [orderId], references: [id])
  orderId   String
  title     String
  price     Int
  qty       Int
}

model User {
  id        String   @id @default(uuid())
  name      String
  mobile    String   @unique
  gender    String
  address   String
  maritalStatus String?
  createdAt DateTime @default(now())
  attempts  QuizAttempt[]
  progresses Progress[]
  rewards   Reward[]
  orders    Order[]
  japaChant JapaChant?
}

model Quiz {
  id        String   @id @default(uuid())
  title     String
  type      String   @unique
  maxScore  Int
  createdAt DateTime @default(now())
  attempts  QuizAttempt[]
}

model QuizAttempt {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  quiz      Quiz     @relation(fields: [quizId], references: [id])
  quizId    String   
  answers   Json
  score     Int      
  reward    Int      
  createdAt DateTime @default(now())
}
model JapaChant {
  id         String   @id @default(uuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String   @unique
  chantCount Int
  createdAt  DateTime @default(now())
}

model Progress {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  pName     String   // e.g. "Prepare", "Perform", etc.
  completed Boolean  // true if P is completed
  percent  Float
  updatedAt DateTime @updatedAt
  @@unique([userId, pName])
}

model Reward {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  type      String   // e.g. "book", "aarti", "donation"
  points    Int
  createdAt DateTime @default(now())
}
// Prisma schema for selfie contest submissions
// Run `npx prisma generate && npx prisma migrate dev` after editing this file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SelfieSubmission {
  id        String   @id @default(uuid())
  instagram String
  createdAt DateTime @default(now())
}

// model QuizAttempt {
//   id        String   @id @default(uuid())
//   name      String?
//   mobile    String?
//   answers   Json
//   score     Int
//   createdAt DateTime @default(now())
// }


enum UserType_ZEnum {
  VEC_STORE_OWNER
  STORE_OWNER
  CAPTAIN
  DISTRIBUTOR
}

enum StoreType_ZEnum {
  VEC
  NORMAL
}

model User_Z {
  id                 String           @id @default(cuid())
  email              String?          // Made nullable for partial users created by store owners
  password_hash      String?          // Made nullable for partial users - will be set during registration
  name               String
  phone              String           @unique // Phone is now the primary lookup identifier
  userType           UserType_ZEnum
  storeType          StoreType_ZEnum? 
  captainId          String?          
  captain            Captain_Z?       @relation(fields: [captainId], references: [id])
  isFirstLogin       Boolean          @default(true)
  securityQuestion1  Int?
  securityAnswer1    String?
  securityQuestion2  Int?
  securityAnswer2    String?
  rememberMeToken    String?
  rememberMeExpiry   DateTime?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt

  // relations
  inventories        Inventory_Z[]    @relation("inventory_by_user")
  preOrdersAsDistributor PreOrder_Z[] @relation("preorder_by_distributor")
  preOrdersAsStoreOwner  PreOrder_Z[] @relation("preorder_by_storeowner")
  payments           Payment_Z[]      @relation("payments_by_distributor")
  paymentRequest          PaymentRequest_Z[]      @relation("payment_requests_by_distributor")
  notifications      Notification_Z[]

  // Opposite relation fields for all _Z models
  notebooks          Notebook_Z[]     @relation("notebook_by_distributor")
  venueBookings      VenueBooking_Z[] @relation("venue_by_distributor")
  returnRequestsAsDistributor ReturnRequest_Z[] @relation("return_by_distributor")
  returnRequestsAsStoreOwner  ReturnRequest_Z[] @relation("return_by_storeowner")
  sales              Sale_Z[]         @relation("sales_by_distributor")
  dailySales  DailySales_Z[] @relation("daily_sales_by_distributor")

  @@index([email])
}

model Captain_Z {
  id        String   @id @default(cuid())
  name      String
  users     User_Z[]
  createdAt DateTime @default(now())
}


enum PreOrderStatus_Z {
  PENDING
  PACKED
  ACCEPTED
  REJECTED
  COLLECTED
}

enum PaymentStatus_Z {
  PENDING
  VERIFIED
  REJECTED
  COMPLETED
}

enum BookLanguage {
  HINDI
  ENGLISH
  TELUGU
}

enum WarehouseType {
  NORMAL
  VEC
}

model Book_Z {
  id          String       @id @default(cuid())
  name        String
  category    String
  language    BookLanguage
  price       Decimal
  warehouseType WarehouseType
  createdAt   DateTime     @default(now())
  inventories Inventory_Z[]
  dailySales  DailySales_Z[] @relation("book_daily_sales")

  @@unique([name, language, warehouseType])
  @@index([category])
  @@index([warehouseType])
}

model PreOrder_Z {
  id            String         @id @default(cuid())
  distributorId String
  distributor   User_Z         @relation("preorder_by_distributor", fields: [distributorId], references: [id])
  storeOwnerId  String
  storeOwner    User_Z         @relation("preorder_by_storeowner", fields: [storeOwnerId], references: [id])
  items         Json
  status        PreOrderStatus_Z @default(PENDING)
  otp           String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([distributorId])
  @@index([storeOwnerId])
  @@index([status])
}

model Payment_Z {
  id             String        @id @default(cuid())
  distributorId  String
  distributor    User_Z        @relation("payments_by_distributor", fields: [distributorId], references: [id])
  amount         Decimal
  receiptImageUrl String?
  items          Json
  status         PaymentStatus_Z @default(PENDING)
  verifiedById   String?
  verifiedAt     DateTime?
  createdAt      DateTime      @default(now())
  paymentRequest PaymentRequest_Z? @relation("request_to_payment")

  @@index([distributorId])
  @@index([verifiedById])
  @@index([status])
}

model PaymentRequest_Z {
  id             String        @id @default(cuid())
  distributorId  String
  distributor    User_Z        @relation("payment_requests_by_distributor", fields: [distributorId], references: [id])
  dates          DateTime[]    // Array of selected dates
  items          Json          // Book items with quantities
  totalAmount    Decimal       // Total amount calculated from items
  paymentImageUrl String?      // URL of payment screenshot from ImageKit
  status         PaymentStatus_Z @default(PENDING)
  verifiedById   String?       
  verifiedAt     DateTime?
  notes          String?       @db.Text  // Any additional notes
  createdAt      DateTime      @default(now())
  payment        Payment_Z?    @relation("request_to_payment", fields: [paymentId], references: [id])
  paymentId      String?       @unique   // One-to-one relation with Payment_Z

  @@index([distributorId])
  @@index([verifiedById])
  @@index([status])
}

enum InventoryType {
  WAREHOUSE  // For store inventory
  DISTRIBUTOR // For distributor's personal inventory
}

model Inventory_Z {
  id           String        @id @default(cuid())
  userId       String
  user         User_Z       @relation("inventory_by_user", fields: [userId], references: [id])
  bookId       String
  book         Book_Z       @relation(fields: [bookId], references: [id])
  quantity     Int
  inventoryType InventoryType
  warehouseType StoreType_ZEnum? // Only for WAREHOUSE type inventory
  updatedAt    DateTime     @updatedAt

  @@index([userId])
  @@index([bookId])
  @@index([inventoryType])
  @@index([warehouseType])
}

model Notification_Z {
  id        String   @id @default(cuid())
  userId    String
  user      User_Z   @relation(fields: [userId], references: [id])
  type      String
  title     String
  message   String
  read      Boolean  @default(false)
  metadata  Json?
  createdAt DateTime @default(now())

  @@index([userId])
}

model PushSubscription {
  id         String   @id @default(cuid())
  userId     String?  // optional, associate when known
  endpoint   String   @unique
  keys       Json
  createdAt  DateTime @default(now())

  @@index([userId])
}

// --- Additional operational models (suffix _Z) ---

enum NoteType_ZEnum {
  FOLLOWUP
  FREEFLOW
}

enum ReturnStatus_Z {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
}

model Notebook_Z {
  id             String    @id @default(cuid())
  distributorId  String
  distributor    User_Z    @relation("notebook_by_distributor", fields: [distributorId], references: [id])
  noteType       NoteType_ZEnum
  content        String    @db.Text
  followUpPerson String?
  followUpDate   DateTime?
  dueDate        DateTime?
  reminderSet    Boolean   @default(false)
  reminderSent   Boolean   @default(false)
  createdAt      DateTime  @default(now())

  @@index([distributorId])
  @@index([followUpDate])
  @@index([dueDate])
}

model VenueBooking_Z {
  id           String   @id @default(cuid())
  distributorId String
  distributor  User_Z   @relation("venue_by_distributor", fields: [distributorId], references: [id])
  place        String
  date         DateTime
  startTime    DateTime
  durationMins Int
  createdAt    DateTime @default(now())

  @@index([distributorId])
  @@index([date])
}

model ReturnRequest_Z {
  id             String        @id @default(cuid())
  distributorId  String
  distributor    User_Z        @relation("return_by_distributor", fields: [distributorId], references: [id])
  storeOwnerId   String
  storeOwner     User_Z        @relation("return_by_storeowner", fields: [storeOwnerId], references: [id])
  otp            String?
  items          Json
  status         ReturnStatus_Z @default(PENDING)
  reason         String?       @db.Text
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@index([distributorId])
  @@index([storeOwnerId])
  @@index([status])
  @@index([updatedAt])
}

model Sale_Z {
  id            String   @id @default(cuid())
  distributorId String
  distributor   User_Z   @relation("sales_by_distributor", fields: [distributorId], references: [id])
  customerName  String
  customerPhone String?
  items         Json
  recordedAt    DateTime @default(now())

  @@index([distributorId])
  @@index([recordedAt])
}

model DailySales_Z {
  id            String   @id @default(cuid())
  distributorId String
  distributor   User_Z   @relation("daily_sales_by_distributor", fields: [distributorId], references: [id])
  bookId        String
  book          Book_Z   @relation("book_daily_sales", fields: [bookId], references: [id])
  quantity      Int
  date          DateTime @default(now())

  @@index([distributorId])
  @@index([bookId])
  @@index([date])
}

model User_a {
  id                 String           @id @default(uuid())
  name               String
  email              String?          
  mobile             String           @unique
  password           String
  tempPasswordUsed   Boolean          @default(false)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  
  userCourses     UserCourse[]
}


model Course {
  courseCode String @id
  courseName String
  description String?

  driveMap CourseDriveMap?
  userCourses UserCourse[]
} 

model CourseDriveMap {
  id         String   @id @default(uuid())
  courseCode String   @unique
  driveFolderId  String
  course     Course   @relation(fields: [courseCode], references: [courseCode])
}
model UserCourse {
  id         String   @id @default(uuid())
  userId     String
  courseCode String
  createdAt DateTime @default(now())

  user       User_a   @relation(fields: [userId], references: [id])
  course     Course   @relation(fields: [courseCode], references: [courseCode])

  @@unique([userId, courseCode])
}

model UserProfileb {
  id        String     @id @default(cuid())
  name      String
  mobile    String
  gender    String?
  marital   String?
  createdAt DateTime   @default(now())
  meta      Json?
  attempts  Attemptb[] @relation("UserAttemptsb")
}

model Attemptb {
  id        String   @id @default(cuid())
  userId    String
  quizId    String
  profile   Json
  answers   Json
  score     Json
  createdAt DateTime @default(now())

  user UserProfileb @relation("UserAttemptsb", fields: [userId], references: [id])

  @@index([userId])
}



